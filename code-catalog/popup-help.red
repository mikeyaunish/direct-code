Red [
	Title: "popup-help.red"
]

info-icon: make image! [20x20 #{
    EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEECCCCCC9B9B9B838383
    8383839B9B9BCCCCCCEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEB0B0B02F2F2F1717175353536B6B6B
    6B6B6B5353531717172F2F2FB0B0B0EEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEE6F6F6F181818A0A0A0EEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEA0A0A01818186F6F6FEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEE2E2E2E5A5A5AE1E1E1EEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEEE1E1E15A5A5A2E2E2EEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEE6F6F6F5A5A5AEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE5A5A5A6F6F6FEEEEEEEEEEEE
    EEEEEEB0B0B0181818E1E1E1EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEECD9137000000003791CDEEEEEEEEEEE1E1E1181818B0B0B0EEEEEE
    EEEEEE2F2F2FA0A0A0EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEECD9137000000003791CDEEEEEEEEEEEEEEEEA0A0A02F2F2FEEEEEE
    CCCCCC171717EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE171717CCCCCC
    9B9B9B535353EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE5353539B9B9B
    8383836B6B6BEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEECD9137
    0000000000003791CDEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE6B6B6B838383
    8383836B6B6BEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEECD91373791CD
    B169000000000069B1EEEEEEEEEEEEEEEEEEEEEEEEEEEEEE6B6B6B838383
    9B9B9B535353EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEB1
    6900000000003791CDEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE5353539B9B9B
    CCCCCC171717EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEECD91
    37000000003791CDEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE171717CCCCCC
    EEEEEE2F2F2FA0A0A0EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEECD9137
    000000003791CDEEEEEEEEEEEEEEEEEEEEEEEEEEEEA0A0A02F2F2FEEEEEE
    EEEEEEB0B0B0181818E1E1E1EEEEEEEEEEEEEEEEEEEEEEEEEEEECD913700
    0000000069B1CD91373791CDEEEEEEEEEEEEE1E1E1181818B0B0B0EEEEEE
    EEEEEEEEEEEE6F6F6F5A5A5AEEEEEEEEEEEEEEEEEEEEEEEEEEEEEECD9137
    0000000000003791CDEEEEEEEEEEEEEEEEEE5A5A5A6F6F6FEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEE2E2E2E5A5A5AE1E1E1EEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEEE1E1E15A5A5A2E2E2EEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEE6F6F6F181818A0A0A0EEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEA0A0A01818186F6F6FEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEB0B0B02F2F2F1717175353536B6B6B
    6B6B6B5353531717172F2F2FB0B0B0EEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
    EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEECCCCCC9B9B9B838383
    8383839B9B9BCCCCCCEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE
}]	

get-absolute-offset: function [
	face
][
	offset-adjust: [ 6x6 8x31 6x26 8x51 ] ; items 1 = no-decor, 2 = Win Bar only, 3 = Menu, 4 = Bar + Menu ; 4x4 added as a fix
	adjust-index: 1
	adjustment: 0
	results: face/offset
	target: face/parent
	until [
		results: results + target/offset
		if target/type = 'window [
			if not find target/flags 'no-title [ adjust-index: adjust-index + 1 ]
			if not none? target/menu [ adjust-index: adjust-index + 2 ]
			adjustment: (pick offset-adjust adjust-index)
		]
		target: target/parent
		(target/type = 'screen)
	]
	return (results + adjustment)
]

set 'popup-help func [	;-- popup-help:
    "Displays a popup help message. By default message will show in one line. V2"
    message [string!]  "Message to display"
    /offset the-offset 
    /close
    /size message-size {Width or pair of message size}
    /box {Display message in a box. Good for longer messages}
][
    if close [
        unview/only --popup-help-window--
        exit
    ]
    message-object: 'text
    if not size [
        message-size: either box [
            num-of-chars: length? message
            chars-per-line: 44
            num-of-lines: (round/ceiling num-of-chars / chars-per-line) + ((length? split message "^/") - 1)
            total-lines-needed: num-of-lines + 1
            height: round/ceiling total-lines-needed * 21.15
            to-pair reduce [ 400 height]
        ][
            []                    
        ]    
    ]
    either offset [
        view-options: compose [ offset: (the-offset) ]    
    ][
        view-options: copy []
    ]
    if box [
        message-object: 'area
    ]
    view/flags/options --popup-help-window--: layout/tight compose [
    	backdrop 232.232.100
        (message-object) (message-size) message font-size 12 wrap
        return 
    ][ ;-- flags
        popup no-title
    ]
    view-options
]    
